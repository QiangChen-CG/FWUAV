\documentclass[10pt]{article}
\usepackage[letterpaper,text={6.5in,8.6in},centering]{geometry}
\usepackage{amssymb,amsmath,amsthm,times,graphicx,subfigure}
\usepackage{enumitem}
%\usepackage{warmread}
%\usepackage[all,import]{xy}
\usepackage{trimclip} % for AR symbol
\usepackage{nomencl}

\newcommand{\norm}[1]{\ensuremath{\left\| #1 \right\|}}
\newcommand{\bracket}[1]{\ensuremath{\left[ #1 \right]}}
\newcommand{\braces}[1]{\ensuremath{\left\{ #1 \right\}}}
\newcommand{\parenth}[1]{\ensuremath{\left( #1 \right)}}
\newcommand{\pair}[1]{\ensuremath{\langle #1 \rangle}}
\newcommand{\met}[1]{\ensuremath{\langle\langle #1 \rangle\rangle}}
\newcommand{\refeqn}[1]{(\ref{eqn:#1})}
\newcommand{\reffig}[1]{Fig. \ref{fig:#1}}
\newcommand{\tr}[1]{\mathrm{tr}\ensuremath{\negthickspace\bracket{#1}}}
\newcommand{\trs}[1]{\mathrm{tr}\ensuremath{[#1]}}
\newcommand{\ave}[1]{\mathrm{E}\ensuremath{[#1]}}
\newcommand{\deriv}[2]{\ensuremath{\frac{\partial #1}{\partial #2}}}
\newcommand{\SO}{\ensuremath{\mathsf{SO(3)}}}
\newcommand{\T}{\ensuremath{\mathsf{T}}}
\renewcommand{\L}{\ensuremath{\mathsf{L}}}
\newcommand{\so}{\ensuremath{\mathfrak{so}(3)}}
\newcommand{\SE}{\ensuremath{\mathsf{SE(3)}}}
\newcommand{\se}{\ensuremath{\mathfrak{se}(3)}}
\renewcommand{\Re}{\ensuremath{\mathbb{R}}}
\newcommand{\aSE}[2]{\ensuremath{\begin{bmatrix}#1&#2\\0&1\end{bmatrix}}}
\newcommand{\ase}[2]{\ensuremath{\begin{bmatrix}#1&#2\\0&0\end{bmatrix}}}
\newcommand{\D}{\ensuremath{\mathbf{D}}}
\renewcommand{\d}{\ensuremath{\mathfrak{d}}}
\newcommand{\Sph}{\ensuremath{\mathsf{S}}}
\renewcommand{\S}{\Sph}
\newcommand{\J}{\ensuremath{\mathbf{J}}}
\newcommand{\Ad}{\ensuremath{\mathrm{Ad}}}
\newcommand{\intp}{\ensuremath{\mathbf{i}}}
\newcommand{\extd}{\ensuremath{\mathbf{d}}}
\newcommand{\hor}{\ensuremath{\mathrm{hor}}}
\newcommand{\ver}{\ensuremath{\mathrm{ver}}}
\newcommand{\dyn}{\ensuremath{\mathrm{dyn}}}
\newcommand{\geo}{\ensuremath{\mathrm{geo}}}
\newcommand{\Q}{\ensuremath{\mathsf{Q}}}
\newcommand{\G}{\ensuremath{\mathsf{G}}}
\newcommand{\g}{\ensuremath{\mathfrak{g}}}
\newcommand{\Hess}{\ensuremath{\mathrm{Hess}}}

\newcommand{\bfi}{\bfseries\itshape\selectfont}
\def\AR{\text{\itshape\clipbox{0pt 0pt .32em 0pt}\AE\kern-.30emR}}
\newcommand{\rot}{\ensuremath{\mathrm{rot}}}

\renewcommand{\baselinestretch}{1.2}

\date{}

\newtheorem{definition}{Definition}
\newtheorem{lem}{Lemma}
\newtheorem{prop}{Proposition}
\newtheorem{remark}{Remark}

\renewcommand{\thesubsection}{\arabic{subsection}. }
\renewcommand{\thesubsubsection}{\arabic{subsection}.\arabic{subsubsection} }

\graphicspath{{./Figs/}}

\renewcommand{\today}{\ifcase \month \or January\or February\or March\or April\or May%
\or June\or July\or August\or September\or October\or November\or December\fi\space \number\day, %
\number \year} 

\makenomenclature

\begin{document}
\section*{Quasi-Steady Dynamics of Flapping Wing UAV}
\vspace{-0.4cm} \noindent{\today}\\


\tableofcontents

\printnomenclature[4cm]

\subsection{Flapping Wing UAV Model}

Consider a flapping wing UAV that is composed of a head, a thorax, an abdomen, and two wings attached to the thorax. 
Here, we assume that the head, the thorax, and the abdomen are coagulated into a single rigid body, which is referred to as \textit{body}. 
We plan to study the motion of the abdomen relative to the thorax in the future. 
Also, we do not distinguish hindwings from forewings. 

Define an inertial frame $\mathcal{F}_I=\{\mathbf{i}_x,\mathbf{i}_y,\mathbf{i}_z\}$, where the third axis points downward, and the first two axes span the horizontal plane. 
This is compatible to the NED (north-east-down) frame common in flight dynamics.
\nomenclature{$\mathcal{F}_I$}{North-East-Down inertial frame}
\nomenclature{$\mathbf{i}_x,\mathbf{i}_y,\mathbf{i}_z$}{basis vector of the inertial frame}

\subsubsection{Body}

Define the body-fixed frame $\mathcal{F}_B=\{\mathbf{b}_x,\mathbf{b}_y,\mathbf{b}_z\}$,
whose origin is located at its mass center of the body.
Following the common convention in flight dynamics, the first axis points toward the head, the second axis point toward the right wing, and the third axis points toward the ventral (belly) side.
\nomenclature{$\mathcal{F}_B$}{body-fixed frame (see Figure \ref{fig:FI_FB})}
\nomenclature{$\mathbf{b}_x,\mathbf{b}_y,\mathbf{b}_z$}{basis vector of the body-fixed frame}

\setlength{\unitlength}{0.1\columnwidth}
\begin{figure}[h]
    \begin{center}
        \footnotesize
        \begin{picture}(3,3)(0,0)
            \put(0,0){\includegraphics[trim={6cm 4cm 5cm 2cm},clip,width=0.3\textwidth]{monarch_FB}}
            \put(-0.1,0.4){$\mathbf{i}_x$}
            \put(0.55,0.65){$\mathbf{i}_y$}
            \put(0.5,0.05){$\mathbf{i}_z$}
            \put(0.7,2.3){$\mathbf{b}_x$}
            \put(2.1,2.6){$\mathbf{b}_y$}
            \put(1.15,0.7){$\mathbf{b}_z$}
        \end{picture}
    \end{center}
    \caption{The inertial frame $\mathcal{F}_I=\{\mathbf{i}_x,\mathbf{i}_y,\mathbf{i}_z\}$ (black) and the body-fixed frame $\mathcal{F}_B=\{\mathbf{b}_x,\mathbf{b}_y,\mathbf{b}_z\}$ (blue)}\label{fig:FI_FB}
\end{figure}
The location of the mass center is given by $x\in\Re^3$ in $\mathcal{F}_I$. 
The attitude of the body is described by $R\in\SO=\{R\in \Re^{3\times 3}\,|\, R^T R = I_{3\times 3},\; \mathrm{det}[R]=1\}$, which represents the linear transformation of a representation of a vector from $\mathcal{F}_B$ to $\mathcal{F}_I$. 
\nomenclature{$\SO$}{three-dimensional special orthogonal group, $\SO=\{R\in \Re^{3\times 3}\,|\, R^T R = I_{3\times 3},\; \mathrm{det}[R]=1\}$}
\nomenclature{$\so$}{Lie algebra of $\SO$, $\so=\{S\in \Re^{3\times 3}\,|\, S^T=-S\}$}
The attitude kinematics is given by
\begin{align}
    \dot R = R \hat \Omega,
\end{align}
where $\Omega\in\Re^3$ is the angular velocity resolved in $\mathcal{F}_B$. 
In the above equation, the \textit{hat} map $\wedge:\Re^3\rightarrow \so$ is defined such that $\hat x y = x\times y$ for any $x,y\in\Re^3$, or equivalently
\begin{align}
    \hat x = \begin{bmatrix}
        0 & -x_3 & x_2 \\
        x_3 & 0 & -x_1 \\
        -x_2 & x_1 & 0 
    \end{bmatrix},\label{eqn:hat_map}
\end{align}
for $x=(x_1,x_2,x_3)\in\Re^3$. 
The inverse of the hat map is denoted by the \textit{vee} map, $\vee: \so\rightarrow \Re^3$.
\nomenclature{$x\in\Re^3$}{the location of the mass center of the body represented in $\mathcal{F}_I$}
\nomenclature{$R\in\SO$}{the attitude of the body, the linear transformation of the representation of a vector from $\mathcal{F}_B$ to $\mathcal{F}_I$}
\nomenclature{$\Omega\in\Re^3$}{the angular velocity of the body represented in $\mathcal{F}_B$}
\nomenclature{$\wedge$}{the hat map\nomrefeq}
\nomenclature{$\vee$}{the vee map\nomrefeq}


\subsubsection{Wing}

\paragraph{Right Wing}

Let $\mathcal{F}_R=\{\mathbf{r}_x,\mathbf{r}_y,\mathbf{r}_z\}$ be the frame fixed to the right wing.
Its origin is located at the joint of the right wing, or the wing root where the right wing is attached to the thorax. 
The vector from the origin of $\mathcal{F}_B$ to the origin of $\mathcal{F}_R$ is defined as $\mu_R\in\Re^3$. 
As it is resolved in $\mathcal{F}_B$ and the body is rigid, $\dot\mu_R=0$.
The first two axes of $\mathcal{F}_R$ span the plane of the wing, where the first axis points toward the leading edge and the second axis points toward the wing tip. 
Consequently, the third axis is normal to the wing plane, and it points toward the ventral side when there is no rotation of the right wing.
\nomenclature{$\mathcal{F}_R$}{frame fixed to the right wing (see Figure~\ref{fig:FR})}
\nomenclature{$\mathbf{r}_x,\mathbf{r}_y,\mathbf{r}_z$}{basis vector of $\mathcal{F}_R$}
\nomenclature{$\mu_R\in\Re^3$}{the fixed vector from the mass center of the body to the root of the right wing resolved in $\mathcal{F}_B$}

\setlength{\unitlength}{0.1\columnwidth}
\begin{figure}[h]
    \begin{center}
        \footnotesize
        \begin{picture}(3,2.4)(0,0)
           \put(0,0){\includegraphics[trim={3cm 2cm 2cm 1cm},clip,width=0.3\textwidth]{monarch_FR}}
           \put(1.6,2.2){$\mathbf{r}_x$}
           \put(1.2,2.25){$\mathbf{b}_x$}
           \put(2.7,1.1){$\mathbf{r}_y$}
           \put(2.85,0.75){$\mathbf{b}_y$}
        \end{picture}
    \end{center}
    \caption{The body-fixed frame $\mathcal{F}_B=\{\mathbf{b}_x,\mathbf{b}_y,\mathbf{b}_z\}$ (blue), the right wing frame $\mathcal{F}_R=\{\mathbf{r}_x,\mathbf{r}_y,\mathbf{r}_z\}$ (red)}\label{fig:FR}
\end{figure}

Next, we introduce the stroke frame $\mathcal{F}_S=\{\mathbf{s}_x,\mathbf{s}_y,\mathbf{s}_z\}$, which is constructed by translating the origin of $\mathcal{F}_B$ to the center of the left wing root and the right wing root, and rotating it about $\mathbf{b}_y$ by $\beta\in[-\pi,\pi)$.
The $y$--$z$ plane of $\mathcal{F}_S$ is referred to as the stroke plane. 

\setlength{\unitlength}{0.1\columnwidth}
\begin{figure}[h]
    \begin{center}
        \footnotesize
        \begin{picture}(3,2.6)(0,0)
           \put(0,0){\includegraphics[trim={5cm 3cm 3cm 2cm},clip,width=0.3\textwidth]{monarch_FS}}
           \put(1.95,2.0){$\mathbf{s}_x$}
           \put(2.5,1.95){$\mathbf{b}_x$}
           \put(2.2,0.45){$\mathbf{s}_z$}
           \put(2.05,-0.05){$\mathbf{b}_z$}
           \put(2.05,1.7){$\beta>0$}
           \put(0.05,1.9){\shortstack[c]{stroke\\plane}}
        \end{picture}
    \end{center}
    \caption{The body-fixed frame $\mathcal{F}_B=\{\mathbf{b}_x,\mathbf{b}_y,\mathbf{b}_z\}$ (blue), the stroke frame $\mathcal{F}_S=\{\mathbf{s}_x,\mathbf{s}_y,\mathbf{s}_z\}$ (green)}\label{fig:FS}
\end{figure}

The angle $\beta$ can be considered as the angle between $\mathbf{b}_x$, and $\mathbf{s}_x$ that is normal to the stroke plane. 
Or equivalently, it is the angle between $y$--$z$ plane of $\mathcal{F}_B$ and the stroke plane.
It is positive when $\mathbf{s}_x\cdot \mathbf{b}_z <0$.  
This angle is often defined as the angle between the ground, horizontal plane and the stroke plane, considering hovering flights with a fixed attitude of the body.
Here, it is defined relative to $\mathcal{F}_B$ as the flapping motion is inherently relative to the body. 
\nomenclature{$\mathcal{F}_S$}{stroke frame (see Figure \ref{fig:FS})}
\nomenclature{$\mathbf{s}_x,\mathbf{s}_y,\mathbf{s}_z$}{basis vector of $\mathcal{F}_S$}
\nomenclature{$\beta\in[-\pi,\pi)$}{the angle between $\mathbf{b}_x$ and $\mathbf{s}_x$ that is normal to the stroke plane, or equivalently, the angle between $y$--$z$ plane of $\mathcal{F}_B$ and the stroke plane.
It is positive when $\mathbf{s}_x\cdot \mathbf{b}_z <0$.  (see Figure \ref{fig:FS})}

\begin{figure}
    \centerline{
        \footnotesize
        \subfigure[flapping angle]{
        \begin{picture}(3,2.6)(0,0)
           \put(0,0){\includegraphics[trim={4cm 3cm 4cm 1.5cm},clip,width=0.3\textwidth]{monarch_FR_phi}}
           \put(1.9,1.4){$\phi>0$}
           \put(2.75,1.9){$\mathbf{s}_y$}
           \put(2.2,0.6){$\mathbf{r}_y$}
        \end{picture}
    }
        \subfigure[pitch angle]{
        \begin{picture}(3,2.6)(0,0)
           \put(0,0){\includegraphics[trim={4cm 3cm 2.5cm 1.5cm},clip,width=0.3\textwidth]{monarch_FR_theta}}
           \put(1.3,1.7){$\theta>0$}
           \put(1.1,2.3){$\mathbf{r}_x$}
           \put(2.0,1.85){$\mathbf{s}_x$}
        \end{picture}
    }
        \subfigure[deviation angle]{
        \begin{picture}(3,2.6)(0,0)
           \put(0,0){\includegraphics[trim={3cm 2cm 3cm 2cm},clip,width=0.3\textwidth]{monarch_FR_psi}}
           \put(1.8,1.3){$\psi>0$}
           \put(2.8,1.4){$\mathbf{r}_y$}
           \put(2.8,0.95){$\mathbf{s}_y$}
        \end{picture}
    }
}
\caption{Wing configuration when only one of $(\phi,\theta,\psi)$ is non-zero}\label{fig:wing_Euler}
\end{figure}


The motion of the right wing relative to $\mathcal{F}_S$ is described by 1--3--2 Euler angles $(\phi_R,\psi_R,\theta_R)$. 
Consequently, the orientation of the right wing relative to $\mathcal{F}_B$, namely $Q_R\in\SO$ is described by
\begin{align}
    Q_R(t) = \exp(\beta \hat e_2)\exp(\phi_R(t) \hat e_1) \exp(-\psi_R(t) \hat e_3) \exp(\theta_R(t) \hat e_2),
\end{align}
which is the linear transformation of a representation of a vector from $\mathcal{F}_R$ to $\mathcal{F}_B$. 
The Euler-angles are defined as
\begin{itemize}[leftmargin=2.5cm]
    \item[$\phi_R\in[-\pi,\pi)$] the flapping angle, which is positive when the wing is in the ventral side, i.e., $\dot\phi>0$ corresponds to downstroke and $\dot\phi<0$ corresponds to upstroke (this is also referred to as the stroke angle or the sweep angle in other papers)
    \item[$\theta_R\in[-\pi,\pi)$] the pitch angle about the axis from the wing root to the wing tip, which is positive when the leading edge of the wing is rotated toward the dorsal side (this is also referred to as the feathering angle or the rotation angle in other papers)
    \item[$\psi_R\in[-\pi,\pi)$] the deviation angle that governs the motion of the wing tip out of the stroke plane, which is positive when the wing tip is rotated toward the head 
\end{itemize}
\nomenclature{$Q_R\in\SO$}{the attitude of the right wing,  the linear transformation of the representation of a vector from $\mathcal{F}_R$ to $\mathcal{F}_B$}
\nomenclature{$\phi\in[-\pi,\pi)$}{flapping angle (see Figure \ref{fig:wing_Euler})}
\nomenclature{$\theta\in[-\pi,\pi)$}{pitch angle (see Figure \ref{fig:wing_Euler})}
\nomenclature{$\psi\in[-\pi,\pi)$}{deviation angle (see Figure \ref{fig:wing_Euler})}


The time-derivative of $Q_R$ is given by
\begin{align}
    \dot Q_R = Q_R \hat \Omega_R,
\end{align}
where $\Omega_R\in\Re^3$ is the angular velocity of the right wing relative to $\mathcal{F}_B$ resolved in $\mathcal{F}_R$.
\nomenclature{$\Omega_R\in\Re^3$}{the angular velocity of the right wing relative to $\mathcal{F}_b$ resolved in $\mathcal{F}_R$}
One can show that the angular velocity of the right wing is obtained from the time-derivatives of the Euler-angles as 
\begin{align}
    \Omega_R & =
    \begin{bmatrix} 
        \cos\psi_R\cos\theta_R & 0 & \sin\theta_R \\
        \sin\psi_R & 1 & 0 \\
        \cos\psi_R\sin\theta_R& 0& -\cos\theta_R
    \end{bmatrix}
    \begin{bmatrix}
        \dot\phi_R \\ \dot\theta_R \\ \dot\psi_R
    \end{bmatrix}.
\end{align}
The determinant of the above $3\times 3$ matrix is $-\cos\psi_R$. 
Consequently, it is invertible when the deviation angle satisfies $\psi_R\neq \pm\frac{\pi}{2}$. 
This is not restrictive as the deviation angle is small in general. 


\paragraph{Left Wing}

Similarly, let $\mathcal{F}_L$ be the frame fixed to the left wing.
It can be obtained by translating $\mathcal{F}_R$ to the root of the left wing without any rotation.
More specifically, its origin is located at the joint of the left wing, where the left wing is attached to the thorax. 
The first two axes span the plane of the wing, where the first axis points toward the leading edge and the second axis points toward the right wing, opposite to the left wing tip.
Consequently, the third axis is normal to the wing plane, and it points toward the ventral side when there is no rotation of the left wing.
\nomenclature{$\mathcal{F}_L$}{frame fixed to the left wing (see Figure~\ref{fig:FL})}
\nomenclature{$\mathbf{l}_x,\mathbf{l}_y,\mathbf{l}_z$}{basis vector of $\mathcal{F}_L$}
\nomenclature{$\mu_L\in\Re^3$}{the fixed vector from the mass center of the body to the root of the left wing resolved in $\mathcal{F}_B$}

\setlength{\unitlength}{0.1\columnwidth}
\begin{figure}[h]
    \begin{center}
        \footnotesize
        \begin{picture}(3,2.4)(0,0)
           \put(0,0){\includegraphics[trim={3cm 2cm 2cm 1cm},clip,width=0.3\textwidth]{monarch_FL}}
           \put(1.5,2.25){$\mathbf{b}_x$}
           \put(1.2,2.15){$\mathbf{l}_x$}
           \put(2.5,1.1){$\mathbf{l}_y$}
           \put(2.85,0.75){$\mathbf{b}_y$}
        \end{picture}
    \end{center}
    \caption{The body-fixed frame $\mathcal{F}_B=\{\mathbf{b}_x,\mathbf{b}_y,\mathbf{b}_z\}$ (blue), the left wing frame $\mathcal{F}_L=\{\mathbf{l}_x,\mathbf{l}_y,\mathbf{l}_z\}$ (red)}\label{fig:FL}
\end{figure}

Similar as the right wing, the motion of the left wing relative to the thorax is described by $Q_L\in\SO$, which is described by successive rotations as
\begin{align}
    Q_L(t) = \exp(\beta \hat e_2)\exp(-\phi_L(t) \hat e_1) \exp(\psi_L(t) \hat e_3) \exp(\theta_L(t) \hat e_2),
\end{align}
where the definition of the Euler-angles $(\phi_L,\theta_L,\psi_L)$ are consistent with those of the right wing.
The wing kinematics become symmetric when $(\phi_R,\theta_R,\psi_R)=(\phi_L,\theta_L,\psi_L)$. 
\nomenclature{$Q_L\in\SO$}{the attitude of the left wing,  the linear transformation of the representation of a vector from $\mathcal{F}_L$ to $\mathcal{F}_B$}
\nomenclature{$\Omega_L\in\Re^3$}{the angular velocity of the left wing relative to $\mathcal{F}_b$ resolved in $\mathcal{F}_L$}

The time-derivative of $Q_L$ is given by
\begin{align}
    \dot Q_L = Q_L \hat \Omega_L,
\end{align}
where $\Omega_L\in\Re^3$ is the angular velocity of the left wing relative to $\mathcal{F}_B$ resolved in $\mathcal{F}_L$.
Also, we have
\begin{align}
    \Omega_L & =
    \begin{bmatrix} 
        -\cos\psi_L\cos\theta_L & 0 & -\sin\theta_L \\
        \sin\psi_L & 1 & 0 \\
        -\cos\psi_L\sin\theta_L& 0& \cos\theta_L
    \end{bmatrix}
    \begin{bmatrix}
        \dot\phi_L \\ \dot\theta_L \\ \dot\psi_L
    \end{bmatrix}.
\end{align}

\subsubsection{Wing Kinematics}

We consider the wing kinematics model presented in~\cite{berman2007energy}.
Let $f\in\Re$ be the frequency of the flapping in \mathrm{Hz}.
Thus, the period of the flapping is $T=\frac{1}{f}$. 
\nomenclature{$f\in\Re$}{flapping frequency}
\nomenclature{$T\in\Re$}{flapping period}

The flapping angle is given by a smoothed triangular waveform,
\begin{align}
    \phi(t) & = \frac{\phi_m}{\sin^{-1} \phi_K}\sin^{-1}(\phi_K\cos(2\pi f t)) + \phi_0,\label{eqn:phi}
\end{align}
where $\phi_m\in\Re$ is the amplitude of flapping, and $\phi_0\in\Re$ is the offset. 
The parameter $0 < \phi_K \leq 1$ determines the shape of flapping waveform (sinusoidal when $\phi_K\rightarrow 0$; triangular when $\phi_K\rightarrow 1$).
The initial pitch angle is $\phi(0)=\phi_m+\phi_0$.
During $0\leq t \leq \frac{T}{2}$, the pitch angle decreases to $\phi(\frac{T}{2}) = -\phi_m+\phi_0$. 
Therefore, it represents upstroke when $0\leq t \leq \frac{T}{2}$, and it represents downstroke when $\frac{T}{2} \leq t \leq T$.

In~\cite{berman2007energy}, the inner term is given by $\sin(2\pi f t)$, instead of $\cos(2\pi f t)$ as in~\eqref{eqn:phi}. 
By following the convention of~\cite{bluman2017wing}, we use the cosine.
This is to ensure that in the subsequent expression of the pitch angle, the pitch angle reversal happens at the end of the downstroke or at the end of upstorke when there is no phase offset ($\theta_a=0$).

\nomenclature{$\phi_m\in[0,\frac{\pi}{2}]$}{flapping amplitude\nomrefeq}
\nomenclature{$\phi_o\in[\theta_m-\frac{\pi}{2},\frac{\pi}{2}-\theta_m]$}{flapping offset\nomrefeq}
\nomenclature{$\phi_K\in(0,1)$}{flapping waveform parameter\nomrefeq}

The pitch angle is given by a hyperbolic function,
\begin{align}
    \theta(t) = \frac{\theta_m}{\tanh \theta_C} \tanh( \theta_C \sin(2\pi f t + \theta_a)) +\theta_0,
\end{align}
where $\theta_m\in\Re$ is the amplitude of pitching, and $\theta_0\in\Re$ is the offset. 
The parameter $\theta_C\in(0,\infty)$ determines the waveform (sinusoidal when $\theta_C\rightarrow 0$; step function when $\theta_C\rightarrow \infty$).
The value of $\theta_C$ is related to the duration of the wing pitch reversal. 
The parameter $\theta_a\in(-\pi,\pi)$ describes the offset in phase (advance rotation for $\theta_a>0$; symmetric rotation for $\theta_a=0$; delayed rotation for $\theta_a<0$).
\nomenclature{$\theta_m\in[0,\frac{\pi}{2}]$}{pitching amplitude\nomrefeq}
\nomenclature{$\theta_o\in[\theta_m-\pi,\pi-\theta_m]$}{pitching offset\nomrefeq}
\nomenclature{$\theta_C\in(0,\infty)$}{pitching waveform parameter\nomrefeq}
\nomenclature{$\theta_a\in(-\pi,\pi)$}{pitching phase offset\nomrefeq}

Finally, the deviation angle is given by a sinusoidal oscillation,
\begin{align}
    \psi(t) = \psi_m \cos(2\pi \psi_N f t + \psi_a) + \psi_0,
\end{align}
where $\psi_m\in\Re$ is the amplitude of the deviation, and $\psi_0\in\Re$ is the offset. 
The parameter $\psi_N$ is either 1 or 2: $\psi_N=1$ corresponds to one oscillation per a flapping period, and $\psi_N=2$ corresponds to a figure-eight motion. 
The parameter $\psi_a\in(-\pi,\pi)$ describes the offset in phase. 
See Figure \ref{fig:wing_kinematics} for the trajectories of these angles for selected parameters. 
\nomenclature{$\psi_m\in\Re$}{deviation amplitude\nomrefeq}
\nomenclature{$\psi_o\in\Re$}{deviation offset\nomrefeq}
\nomenclature{$\psi_N\in\{1,2\}$}{deviation oscillation per a flapping\nomrefeq}
\nomenclature{$\psi_a\in(-\pi,\pi)$}{deviation phase offset\nomrefeq}

\begin{figure}
    \centerline{
        \includegraphics[width=0.7\textwidth]{wing_kinematics}
    }
    \caption{Wing kinematics when $\phi_m=50^\circ$, $\phi_0=10^\circ$, $\theta_m=45^\circ$, $\theta_0=0$, $\theta_a=0.3$, $\phi_m=10^\circ$, $\phi_0=\phi_a=0$}\label{fig:wing_kinematics} 
\end{figure}












\subsection{Quasi-Steady Aerodynamics}

The quasi-steady assumption implies that the aerodynamic force and moment generated by the flapping wing are equivalent to those for steady motion at the same instantaneous velocity and the angle of attack. 

\subsubsection{Wing Morphological Parameters}

\setlength{\unitlength}{0.1\columnwidth}
\begin{figure}[h]
    \begin{center}
        \footnotesize
        \begin{picture}(3,2.4)(0,0)
           \put(0,0){\includegraphics[trim={3cm 2cm 2cm 1cm},clip,width=0.3\textwidth]{monarch_FR}}
           \put(1.6,2.2){$\mathbf{r}_x$}
           \put(2.7,1.1){$\mathbf{r}_y$}
           \linethickness{0.2em}
           \put(2.1,1.57){\line(0,-1){1.50}}
           \put(2.15,0.7){$c(r)$}
           \put(2.05,-0.1){$dr$}
           \put(1.8,1.05){$r$}
        \end{picture}
    \end{center}
    \caption{Infinitesimal wing segment }\label{fig:wing_segment}
\end{figure}

We first present several morphological parameters of the wing as formulated in to~\cite{ellington1984aerodynamics}, after making a few changes in the notation.  
More specifically, in~\cite{ellington1984aerodynamics}, the symbol $\wedge$ is used to denote normalized variables. 
However, the same symbol is used for the hat map in \eqref{eqn:hat_map}.
Instead, we use the symbol $\tilde{\;\;}$ for the normalized variables to avoid conflict with~\eqref{eqn:hat_map}.
Also, the morphological parameters are defined for a single wing as the aerodynamic force of the left wing will be distinguished from the right wing for non-symmetric flapping. 

Let $dr$ be the infinitesimal wing segment located distanced at $r$ from the wing root. 
Let its chord be defined as $c(r)$. 
The wing segment is parallel to $\mathbf{r}_x$ and the distance is measured along $\mathbf{r}_y$.
Assume that the aerodynamic center of the segment is along $\mathbf{r}_y$, i.e., the resultant force generated by the wing segment is located along $\mathbf{r}_y$ with zero moment. 
Consequently, it is located at $re_2$ when resolved in $\mathcal{F}_R$.
\nomenclature{$c(r)\in\Re$}{the length of the chord at the distance $r$ from the wing root (see Figure~\ref{fig:wing_segment})}

The area of the right wing is given by
\begin{align}
    S = \int_0^{l} c(r) dr,
\end{align}
where $l>0$ is the wing span, i.e., the distance between the wing root and the wing tip measure along $\mathbf{r}_y$.
\nomenclature{$S\in\Re$}{the area of the right wing (In~\cite{ellington1984aerodynamics}, the symbol $S$ used for the total area of the left wing and the right wing)}%
\nomenclature{$l\in\Re$}{the span of the right wing, i.e., the length of the right wing from the wing root and the wing tip}%
The non-dimensional aspect ratio is
\begin{align}
    \AR = \frac{l^2}{S}.
\end{align}
\nomenclature{$\AR$}{the aspect ratio of the wing\nomrefeq}
The mean chord is the area divided by the span, i.e., $\bar c = \frac{S}{l}$, and the normalized wing chord is
\begin{align}
    \tilde c = \frac{c}{\bar c} = \frac{c l}{S}.
\end{align}
\nomenclature{$\bar c\in\Re$}{mean chord\nomrefeq}
\nomenclature{$\tilde c\in\Re$}{normalized chord\nomrefeq (this is equivalent to $\hat c$ in~\cite{ellington1984aerodynamics})}
Also, the non-dimensional radius is defined as
\begin{align}
    \tilde r = \frac{r}{l}.
\end{align}
\nomenclature{$\tilde r\in\Re$}{normalized radius\nomrefeq (this is equivalent to $\hat r$ in~\cite{ellington1984aerodynamics})}

The $k$-th moment of wing area is defined as
\begin{align}
    S_k = \int_0^{l} r^k c(r) dr = Sl^k \int_0^1 \tilde r^k \tilde c  d\tilde r,
\end{align}
satisfying $S_0=S$.
The non-dimensional radius of the $k$-th moment of wing area is defined as
\begin{align}
    \tilde r_k = \parenth{\frac{S_k}{Sl^k}}^{\frac{1}{k}} 
    = \parenth{\frac{1}{Sl^k} \int_0^{l} r^k c(r) dr}^{\frac{1}{k}} 
    = \parenth{\int_0^1 \tilde r^k \tilde c d\tilde r}^{\frac{1}{k}}, \label{eqn:tilde_r_k}
\end{align}
such that $S_k = (\tilde r_k l)^k S$, i.e., if all of the wing area is located at a distance $\tilde r_k l$, the $k$-th moment of area is equal to $S_k$.
\nomenclature{${S_k \in\Re}$}{the $k$-th moment of wing area}
\nomenclature{${\tilde r_k \in\Re}$}{non-dimensional radius of the $k$-th moment of wing area (this is equivalent to $\hat r_k(S)$, or (7) of ~\cite{ellington1984aerodynamics})}

Next, when a wing is accelerated, it causes the motion of the surrounding air.
The inertia of the wing is increased by the mass of air that is accelerated, and therefore there is an increase in the wing mass. 
The normalized virtual mass is defined as
\begin{align}
    \tilde v = \int_0^1 \tilde c^2 d\tilde r.
\end{align}
\nomenclature{${\tilde v \in\Re}$}{non-dimensional virtual mass of the wing (this is equivalent to $\hat v$, or (14) of ~\cite{ellington1984aerodynamics})}
%
And the corresponding normalized radius of the $k$-th moment of virtual mass is 
\begin{align}
    \tilde r_k (v) = \parenth{ \frac{1}{\tilde v} \int_0^1 \tilde c^2 \tilde r^k d\tilde r }^{\frac{1}{k}}.
\end{align}
\nomenclature{${\tilde r_k(v) \in\Re}$}{non-dimensional radius of the $k$-th moment of wing volume (this is equivalent to $\hat r_k(v)$, or (16) of ~\cite{ellington1984aerodynamics})}

Later, we need to compute the following quantity:
\begin{align}
    \int_0^l r c^2(r) dr & = l^2 \bar c^2 \int_0^1 \tilde r \tilde c^2 d\tilde r = l^2 \bar c^2 \tilde v \tilde r_1(v),\label{eqn:int_rc2dr} \\
    \int_0^l r^2 c^2(r) dr & = l^3 \bar c^2 \int_0^1 \tilde r^2 \tilde c^2 d\tilde r = l^2 \bar c^2 \tilde v \tilde r_2^2(v).\label{eqn:int_r2c2dr} 
\end{align}

\subsubsection{Blade-Element Theory}

\paragraph{Angle of Attack of Right Wing}

When resolved in the inertial frame, the root of the right wing is located at $x+R\mu_R$. 
Thus, the aerodynamic center of the chord at the distance $r$ from the wing root is
\[
    x+R\mu_R + RQ_R r e_2.
\]
Therefore, its velocity in $\mathcal{F}_I$ is 
\[
    \dot x+ R\hat\Omega \mu_R + R \hat\Omega Q_R re_2 + R Q_R \hat \Omega_R r e_2,   
\]
which is transformed to $\mathcal{F}_R$ by left-multiplying $Q_R^T R^T$ as
\begin{align*}
    Q_R^T R^T \dot x & +  Q_R^T \hat\Omega \mu_R +  Q_R^T \hat\Omega Q_R re_2 +  \hat \Omega_R r e_2\\
              & = Q_R^T( R^T \dot x + \Omega\times \mu_R ) + r  (Q_R\Omega + \Omega_R )\times e_2,
\end{align*}
where the first term corresponds to the velocity of the wing root and the second term corresponds to the velocity of the aerodynamic center relative to the wing root. 
Both are resolved in $\mathcal{F}_R$. 

Assume that there is a uniform wind with the velocity $v_{\mathrm{wind}}\in\Re^3$ resolved in $\mathcal{F}_I$. 
The velocity of the aerodynamic center of $c(r)$ relative to the wind is given by
\begin{align*}
    Q_R^T( R^T (\dot x-v_{\mathrm{wind}}) + \Omega\times \mu_R ) + r  (Q_R\Omega + \Omega_R )\times e_2,
\end{align*}
According to the \textit{blade-element theory}~\cite{ellington1984aerodynamics}, the aerodynamic force generated by the infinitesimal chord is independent of the span-wise velocity component, i.e., the component of the above expression along $\mathbf{r}_y$ is irrelevant. 
Therefore, we project the above velocity to the $\mathbf{r}_x$--$\mathbf{r}_z$ plane as follows.
\begin{align}
    U_R(r) = (I_{3\times 3}- e_2 e_2^T) Q_R^T( R^T (\dot x-v_{\mathrm{wind}}) + \Omega\times \mu_R ) + r  (Q_R\Omega + \Omega_R )\times e_2.\label{eqn:Ur}
\end{align}
where $I_{3\times 3} - e_2e_2^T= \mathrm{diag}[1,0,1]\in\Re^{3\times 3}$ corresponds to the projection operator. 
The second term is not affected by the projection as it is already normal to $e_2$.
\nomenclature{$U(r)\in\Re^3$}{the velocity of the aerodynamic center of the chord $c(r)$ relative to the ambient wind, resolved in the wing fixed frame; this is projected to the $\mathbf{r}_x$--$\mathbf{r}_z$ plane so that the second component is always zero\nomrefeq}

The angle of attack $\alpha_R(r)$ is the angle between the chord line $\pm e_1$ and the above velocity $U_R(r)$. 
Assuming that the chord is a thin blade, when the angle is greater than $\frac{\pi}{2}$, we flip the leading edge and the trailing edge of the chord.
This ensures that $\alpha_R(r)\in[0,\frac{\pi}{2}]$ always. 
More explicitly, 
\begin{align}
    \alpha_R (r) & = 
    \cos^{-1} ( \frac{|e_1^T U_R(r)|}{\|U_R(r)\|} ).\label{eqn:alpha}
\end{align}
The above expression has a singularity when $U(r)=0$. 
But, the value of $\alpha(r)$ does not matter when $U(r)=0$, as the resulting aerodynamic force and moment will vanish.
Or equivalently, it can be written as
\begin{align}
    \alpha_R (r) & = 
    \sin^{-1} ( \frac{|e_3^T U_R(r)|}{\|U_R(r)\|} ).\label{eqn:alpha_3}
\end{align}
\nomenclature{$\alpha\in[0,\frac{\pi}{2}]$}{angle of attack}

\paragraph{Angle of Attack of Left Wing}

For the left wing, \eqref{eqn:Ur} is changed into
\begin{align}
    U_L(r) = (I_{3\times 3}- e_2 e_2^T) Q_L^T( R^T (\dot x-v_{\mathrm{wind}}) + \Omega\times \mu_L ) - r  (Q_L\Omega + \Omega_L )\times e_2.\label{eqn:Ur_R}
\end{align}
The angle of attack is given by
\begin{align}
    \alpha_L (r) & = 
    \cos^{-1} ( \frac{|e_1^T U_L(r)|}{\|U_L(r)\|} ) = 
    \sin^{-1} ( \frac{|e_3^T U_L(r)|}{\|U_L(r)\|} ).\label{eqn:alpha_3_L}
\end{align}

\subsubsection{Translational Forces}

\paragraph{Right Wing}

Here we find the expression of the lift and the drag. 
The magnitude of the lift generated by the infinitesimal wing segment $c(r)$ is
\[
    \frac{1}{2}\rho \|U_R(r)\|^2 C_L(\alpha_R(r)) c(r) dr,
\]
where $\rho\in\Re$ is the atmospheric density, and $C_L\in\Re$ is the lift coefficient given as a function of the angle of attack. 
\nomenclature{$\rho\in\Re$}{atmospheric density}
\nomenclature{$C_L\in\Re$}{lift coefficient}

The direction of the lift is normal to both of the velocity $U_R(r)$ and the wing span-wise direction $e_2$. 
As such, the direction of the lift is along $\pm e_2\times U_R(r)$ in $\mathcal{F}_R$. 
The ambiguity of the sign can be resolved by the fact that when the $\mathbf{r}_x$--$\mathbf{r}_z$ plane is divided by the chord line $\mathbf{r}_x$, the velocity vector $U(r)$ and the lift vector occupy the opposite side with each other. 
\begin{figure}
    \centerline{
        \footnotesize
        \subfigure[Case 1]{
            \begin{picture}(2.5,2.5)(0,0)
                \put(1.25,1.25){\vector(-2,-1){1}}
                \put(1.25,1.25){\vector(-1,2){0.5}}
                \put(0.2,0.5){$U_R(r)$}
                \put(0.0,2.0){\shortstack[c]{$dL_R\parallel$\\$e_2\times U_R(r)$}}
                \put(1.25,1.25){\line(1,0){1}}
                \put(1.55,1.3){chord}
                \linethickness{0.1em}
                \put(1.25,1.25){\vector(-1,0){1}}
                \put(1.25,1.25){\vector(0,-1){1}}
                \put(0.15,1.35){$\mathbf{r}_x$}
                \put(1.3,0.2){$\mathbf{r}_z$}
                \put(0.8,1.12){$\alpha$}
            \end{picture}
        }
        \subfigure[Case 2]{
            \begin{picture}(2.5,2.5)(0,0)
                \put(1.25,1.25){\vector(2,-1){1}}
                \put(1.25,1.25){\vector(1,2){0.5}}
                \put(2.0,0.6){$U_R(r)$}
                \put(0.8,2.0){\shortstack[c]{$dL_R\parallel$\\$-e_2\times U_R(r)$}}
                \put(1.25,1.25){\line(1,0){1}}
                \put(1.55,1.12){$\alpha$}
                \put(1.55,1.3){chord}
                \linethickness{0.1em}
                \put(1.25,1.25){\vector(-1,0){1}}
                \put(1.25,1.25){\vector(0,-1){1}}
                \put(0.15,1.35){$\mathbf{r}_x$}
                \put(1.3,0.2){$\mathbf{r}_z$}
            \end{picture}
        }
        \subfigure[Case 3]{
            \begin{picture}(2.5,2.5)(0,0)
                \put(1.25,1.25){\vector(-2,1){1}}
                \put(1.25,1.25){\vector(-1,-2){0.5}}
                \put(0.1,1.9){$U_R(r)$}
                \put(0.2,0.5){\shortstack[c]{$dL_R\parallel$\\$-e_2\times U_R(r)$}}
                \put(0.8,1.3){$\alpha$}
                \put(1.25,1.25){\line(1,0){1}}
                \put(1.55,1.3){chord}
                \linethickness{0.1em}
                \put(1.25,1.25){\vector(-1,0){1}}
                \put(1.25,1.25){\vector(0,-1){1}}
                \put(0.15,1.35){$\mathbf{r}_x$}
                \put(1.3,0.2){$\mathbf{r}_z$}
            \end{picture}
        }
        \subfigure[Case 4]{
            \begin{picture}(2.5,2.5)(0,0)
                \put(1.25,1.25){\vector(2,1){1}}
                \put(1.25,1.25){\vector(1,-2){0.5}}
                \put(1.9,1.85){$U_R(r)$}
                \put(1.6,0.1){\shortstack[c]{$dL_R\parallel$\\$e_2\times U_R(r)$}}
                \put(1.25,1.25){\line(1,0){1}}
                \put(1.55,1.3){$\alpha$}
                \put(1.55,1.10){chord}
                \linethickness{0.1em}
                \put(1.25,1.25){\vector(-1,0){1}}
                \put(1.25,1.25){\vector(0,-1){1}}
                \put(0.15,1.35){$\mathbf{r}_x$}
                \put(1.3,0.2){$\mathbf{r}_z$}
            \end{picture}
        }
    }
    \caption{Direction of the velocity and the lift in the $\mathbf{r}_x$--$\mathbf{r}_z$ plane of the right wing}\label{fig:lift_direction}
\end{figure}

More specifically, consider the four cases illustrated in Figure~\ref{fig:lift_direction}.
These show that the direction of lift is $e_2\times U_R(r)$ when $e_1^T U_R(r)$ and $e_3^TU_R(r)$ have the same sign (Case 1 and Case 4), and it is $-e_2\times U_R(r)$ when they have the opposite sign (Case 2 and Case 3).
Therefore, the infinitesimal lift vector resolved in $\mathcal{F}_R$ is given by
\begin{align}
    dL_R(r) & = \frac{1}{2}\rho U_R^2(r) C_L(\alpha(r)) c(r) \mathrm{sgn} (e_1^T U_R(r) e_3^T U_R(r)) \frac{e_2\times U_R(r)}{\|e_2\times U(r)\|} dr \nonumber \\
            & = \frac{1}{2}\rho  C_L(\alpha(r)) c(r) \mathrm{sgn} (e_1^T U_R(r) e_3^T U_R(r)) (e_2\times U_R(r))\|U_R(r)\|  dr,\label{eqn:dLR}
\end{align}
where the second equality is obtained by $\|U_R(r)\|=\|e_2\times U_R(r)\|$.

The total lift of the right wing is obtained by integrating above span-wise for $r\in[0,l]$.
\begin{align}
    L_R = \int_{0}^{l} dL_R(r),
\end{align}
which is resolved in $\mathcal{F}_R$. 
\nomenclature{$L_R\in\Re^3$}{the lift vector of the right wing resolved in $\mathcal{F}_R$}

Next, the drag is always opposite to $U_R(r)$. 
Similar with the above expressions, 
\begin{align}
    dD_R(r) = - \frac{1}{2}\rho  C_D(\alpha(r)) c(r) \|U_R(r)\|U_R(r) dr.
\end{align}
The total drag is obtained by integrating above span-wise for $r\in[0,l]$ as
\begin{align}
    D_R = \int_{0}^{l} dD_R (r),
\end{align}
which is resolved in $\mathcal{F}_R$. 
\nomenclature{$D_R\in\Re^3$}{the drag vector of the right wing resolved in $\mathcal{F}_R$}

The lift and the drag also generate the moment about the wing root. 
When resolved in $\mathcal{F}_R$, it is given by
\begin{align}
    M_R = \int_{0}^l r e_2 \times (dL_R + dD_R).
\end{align}
\nomenclature{$M_R\in\Re^3$}{moment about the wing root caused by the lift and the drag of the right wing, resolved in $\mathcal{F}_R$}

\paragraph{Left Wing}

Similarly, the infinitesimal lift vector of the left wing resolved in $\mathcal{F}_L$ is given by
\begin{align}
    dL_L(r)  & = \frac{1}{2}\rho  C_L(\alpha(r)) c(r) \mathrm{sgn} (e_1^T U_L(r) e_3^T U_L(r)) (e_2\times U_L(r))\|U_L(r)\|  dr,\label{eqn:dLL}
\end{align}
which is integrated to obtain
\begin{align}
    L_L & = \int_0^l dL_L(r).
\end{align}
\nomenclature{$L_L\in\Re^3$}{the lift vector of the left wing resolved in $\mathcal{F}_L$}
Also, the infinitesimal drag of the left wing is
\begin{align}
    dD_L(r) = - \frac{1}{2}\rho  C_D(\alpha(r)) c(r) \|U_L(r)\|U_L(r) dr,
\end{align}
and
\begin{align}
    D_L = \int_{0}^{l} dD_L (r),
\end{align}
which is resolved in $\mathcal{F}_R$. 
\nomenclature{$D_L\in\Re^3$}{the drag vector of the left wing resolved in $\mathcal{F}_L$}

The lift and the drag also generate the moment about the wing root as
\begin{align}
    M_L = \int_{0}^l - r e_2 \times (dL_L + dD_L).
\end{align}
\nomenclature{$M_L\in\Re^3$}{moment about the wing root caused by the lift and the drag of the left wing, resolved in $\mathcal{F}_L$}

\subsubsection{Translational Forces for Small Body Velocities}

This above expression requires span-wise integration at every instance to compute the lift and the drag. 
Here we present an explicit expression for a special case when the linear velocity and the angular velocity of the body and the wind velocity are small. i.e., $\|\dot x\|, \|\Omega\|, \|v_{\mathrm{wind}}\| \ll 1$.  

\paragraph{Right Wing}

Under these assumptions, the first part of \eqref{eqn:Ur} vanishes so that the velocity reduces to 
\begin{align*}
    U_R(r) & = r \Omega_R \times e_2,
%    \\
         %& = r  
    %\begin{bmatrix} 
        %\cos\psi_R\cos\theta_R & 0 & \sin\theta_R \\
        %\sin\psi_R & 1 & 0 \\
        %\cos\psi_R\sin\theta_R& 0& -\cos\theta_R
    %\end{bmatrix}
    %\begin{bmatrix}
        %\dot\phi_R \\ \dot\theta_R \\ \dot\psi_R
    %\end{bmatrix} \times e_2 \\
         %& = r  
    %\begin{bmatrix} 
        %-\cos\psi_R\sin\theta_R&  \cos\theta_R\\
        %0 & 0 \\
        %\cos\psi_R\cos\theta_R & \sin\theta_R \\
    %\end{bmatrix}
    %\begin{bmatrix}
        %\dot\phi_R \\  \dot\psi_R
%    \end{bmatrix}.
\end{align*}
which is directly proportional to $r$. 
In~\eqref{eqn:alpha}, this eliminates the dependency of $\alpha$  on $r$ as follows.
\begin{align*}
    \alpha & = \cos^{-1} (\frac{ |e_1^T (\Omega_R \times e_2)|}{\|\Omega_R\times e_2\|}) = \cos^{-1} (\frac{ |e_3^T \Omega_R |}{\|\Omega_R \times e_2\|} ).
\end{align*}
In other words, the angle of attack is identical for all the infinitesimal chord in the right wing. 
Also, from \eqref{eqn:dLR},
\begin{align}
    dL_R(r) & = \frac{1}{2}\rho  C_L(\alpha) c(r) \mathrm{sgn} (e_1^T (\Omega_R\times e_2) e_3^T (\Omega_R\times e_2) ) (e_2\times (\Omega_R\times e_2))\|\Omega_R\times e_2\| r^2 dr\nonumber \\
            & = \frac{1}{2}\rho  C_L(\alpha) c(r) \mathrm{sgn} (-e_3^T \Omega_R e_1^T \Omega_R ) (e_2\times (\Omega_R\times e_2))\|\Omega_R\times e_2\| r^2 dr\nonumber \\
            & = \frac{1}{2}\rho  C_L(\alpha) c(r) \mathrm{sgn} (e_3^T \Omega_R e_1^T \Omega_R ) \hat e_2^2 \Omega_R \|\Omega_R\times e_2\|  r^2 dr\nonumber.
\end{align}
Consequently, the lift of the right wing is given by
\begin{align*}
    L_R & = \frac{1}{2}\rho  C_L(\alpha) \mathrm{sgn} (e_3^T \Omega_R e_1^T \Omega_R ) \hat e_2^2 \Omega_R \|\Omega_R\times e_2\| \int_{0}^{l} c(r)  r^2 dr,
\end{align*}
and using \eqref{eqn:tilde_r_k}
\begin{align*}
    L_R & = \frac{1}{2}\rho  C_L(\alpha) \mathrm{sgn} (e_3^T \Omega_R e_1^T \Omega_R ) \hat e_2^2 \Omega_R \|\Omega_R\times e_2\| l^2 \tilde r_2^2 S,
\end{align*}
which can be evaluated by $\Omega_R$ without integration over the wing span. 

Or, equivalently, define the velocity of the chord at $r=\tilde r_2 l$ as 
\begin{align}
    U_R = U_R(\tilde r_2 l) = \tilde r_2 l \Omega_R \times e_2. \label{eqn:U_R}
\end{align}
\nomenclature{$U_R\in\Re^3$}{the velocity of the chord at $r=\tilde r_2 l$ of the right wing\nomrefeq}
The angle of attack can be rewritten as
\begin{align}
    \alpha_R & = \cos^{-1} (\frac{ |e_1^T U_R|}{\|U_R\|}) = \sin^{-1} (\frac{ |e_3^T U_R|}{\|U_R\|}). \label{eqn:alpha_R}
\end{align}
Thus, the lift of the right wing resolved in $\mathcal{F}_R$ is given by
\begin{align}
    L_R & = \frac{1}{2}\rho  C_L(\alpha) \mathrm{sgn} (e_1^T U_R e_3^T U_R ) \hat e_2 U_R \|U_R\| S,
\end{align}
Similarly, the drag is given by
\begin{align}
    D_R = - \frac{1}{2}\rho  C_D(\alpha)  \|U_R \| U_R  S.
\end{align}
In short, for the special case of small body velocities, the lift and the drag vector of the right wing resolved in $\mathcal{F}_R$ are given by \eqref{eqn:U_R}--\eqref{eqn:alpha_R}.

Define $r_{cp}\in\Re$ such that the above moment is equivalent to the lift and the drag acting on $r_{cp}e_2$, i.e., 
\[
    r_{cp}e_2 \times \int (dL_R + dD_R) = \int re_2 \times (dL_R + dD_R).
\]
For the special case discussed above, one can show
\begin{align}
    r_{cp} & = \dfrac{ \int_{0}^l r^3 c(r) dr}{\int_0^l r^2 c(r) dr} = \frac{S_3}{S_2} = \frac{Sl^3 \tilde r_3^3}{S l^2 \tilde r_2^2} = \frac{\tilde r_3^3}{\tilde r_2^2} l.
\end{align}
\nomenclature{$r_{cp}\in\Re$}{distance from the wing root to the aerodynamic center of the lift and the drag\nomrefeq}
Therefore, the span-wise location of the center of pressure of the right wing is given by $r_{cp}e_2$, and the resulting moment about the wing root is
\begin{align}
    M_R = r_{cp} e_2 \times (L_R + D_R),
\end{align}
which is resolved in $\mathcal{F}_R$.

\paragraph{Left Wing}

For the left wing, define the velocity at the chord $r =\tilde r_2l$ be
\begin{align}
    U_L = U_L(\tilde r_2 l) = -\tilde r_2 \Omega_2 \times e_2.
\end{align}
\nomenclature{$U_L\in\Re^3$}{the velocity of the chord at $r=\tilde r_2 l$ of the left wing\nomrefeq}
The angle of attack is given by
\begin{align}
    \alpha_L & = \cos^{-1} (\frac{ |e_1^T U_L|}{\|U_L\|}) = \sin^{-1} (\frac{ |e_3^T U_L|}{\|U_L\|}). \label{eqn:alpha_L}
\end{align}
The translational force and the moment for the left wing are 
\begin{align}
    L_L & = \frac{1}{2}\rho  C_L(\alpha) \mathrm{sgn} (e_1^T U_L e_3^T U_L ) \hat e_2 U_L \|U_L\| S,\\
    D_L & = - \frac{1}{2}\rho  C_D(\alpha)  \|U_L \| U_L  S,\\
    M_L & = - r_{cp} e_2 \times (L_L + D_L),\label{eqn:M_L}
\end{align}
which are resolved in $\mathcal{F}_L$. 
All of these expressions are consistent with the right wing, except the negative sign in \eqref{eqn:M_L}. 

\subsubsection{Rotational Force}


The wing's own rotation may cause additional circulation about the chord that generate a normal force. 
This is referred to as a rotational force~\cite{sane2002aerodynamic}.
The expression of the rotational force of the right wing is identical to that of the left wing, except the flipped sign in the corresponding moment. 
As such, in this section, we do not distinguish the right wing from the left wing with the subscript $R$. 

According to~\cite{sane2002aerodynamic}, the magnitude of the rotational lift for the infinitesimal wing segment is given by
\begin{align}
    \rho \|U(r)\| C_\rot |\dot\alpha(r)|  c^2(r) dr,\label{eqn:F_rot_mag}
\end{align}
where the last part $C_\rot |\dot\alpha(R)| c^2$ corresponds to the rotational circulation.
From \eqref{eqn:alpha_R}, the time-derivative of the angle of attack multiplied by $\|U\|$ is given by
\begin{align}
    \|U\| \dot \alpha & = \frac{1}{\sin\alpha} \braces{ \cos\alpha \frac{U^T \dot U}{\|U\|} - {\mathrm{sgn}(e_1^T U)(e_1^T \dot U)}} \nonumber\\
    & = \frac{1}{\cos\alpha} \braces{ -\sin\alpha \frac{U^T \dot U}{\|U\|} + {\mathrm{sgn}(e_3^T U)(e_3^T \dot U)}}.
\end{align}
To avoid singularity caused by $\alpha$, the first expression is used when $\alpha$ is close to $\frac{\pi}{2}$, and the second expression is used when $\alpha$ is close to $0$. 
Also, to mitigate the singularity caused by $\|U\|\ll 1$, we evaluate $\|U\|\dot\alpha$ in the numerical implementation, instead of computing $\dot\alpha$ directly.  

Next, we find the direction of the rotational lift. 
It is shown that the rotational lift is always perpendicular to the chord line, and consequently it is $\pm e_3$ in $\mathcal{F}_R$. 
Consider the four cases of $\alpha >0$ illustrated in Figure \ref{fig:lift_direction}.
For the first two cases of $e_3^T U >0$, $\dot\alpha >0$ generates the rotational lift along $-e_3$, and for the last two cases of $e_3^T U(r) <0$,  $\dot\alpha>0$ generates the rotational lift along $e_3$. 
Therefore, when $\alpha >0$, the direction of the rotational lift is $-\mathrm{sgn}(e_3^T U) \mathrm{sgn}(\dot\alpha) e_3$.

\begin{figure}[h]
    \centerline{
        \footnotesize
        \subfigure[Case 1]{
            \begin{picture}(2.5,2.5)(0,0)
                \put(1.25,1.25){\vector(-2,0){1}}
                \put(1.25,1.25){\vector(0,1){1}}
                \put(0.25,1.20){\vector(0,-1){0.3}}
                \put(0.0,1.35){$U(r)$}
                \put(0.0,0.65){$e_3^T\dot U(r)>0$}
                \put(1.3,2.2){$F_\rot$}
                \put(1.25,1.25){\line(1,0){1}}
                \put(1.55,1.3){chord}
                \linethickness{0.1em}
                \put(1.25,1.25){\vector(-1,0){0.6}}
                \put(1.25,1.25){\vector(0,-1){0.6}}
                \put(0.75,1.35){$\mathbf{r}_x$}
                \put(1.3,0.6){$\mathbf{r}_z$}
            \end{picture}
        }
        \subfigure[Case 2]{
            \begin{picture}(2.5,2.5)(0,0)
                \put(1.25,1.25){\vector(-2,0){1}}
                \put(1.25,1.25){\vector(0,-1){1}}
                \put(0.25,1.3){\vector(0,1){0.3}}
                \put(0.0,1.05){$U(r)$}
                \put(0.0,1.7){$e_3^T\dot U(r)<0$}
                \put(1.3,0.2){$F_\rot$}
                \put(1.25,1.25){\line(1,0){1}}
                \put(1.55,1.3){chord}
                \linethickness{0.1em}
                \put(1.25,1.25){\vector(-1,0){0.6}}
                \put(1.25,1.25){\vector(0,-1){0.6}}
                \put(0.75,1.35){$\mathbf{r}_x$}
                \put(1.3,0.6){$\mathbf{r}_z$}
            \end{picture}
        }
        \subfigure[Case 3]{
            \begin{picture}(2.5,2.5)(0,0)
                \put(1.25,1.25){\vector(2,0){1}}
                \put(1.25,1.25){\vector(0,1){1}}
                \put(2.25,1.20){\vector(0,-1){0.3}}
                \put(2.0,1.35){$U(r)$}
                \put(1.8,0.65){$e_3^T\dot U(r)>0$}
                \put(1.3,2.2){$F_\rot$}
                \put(1.25,1.25){\line(-1,0){1}}
                \put(0.3,1.0){chord}
                \linethickness{0.1em}
                \put(1.25,1.25){\vector(-1,0){0.6}}
                \put(1.25,1.25){\vector(0,-1){0.6}}
                \put(0.75,1.35){$\mathbf{r}_x$}
                \put(1.3,0.6){$\mathbf{r}_z$}
            \end{picture}
        }
        \subfigure[Case 4]{
            \begin{picture}(2.5,2.5)(0,0)
                \put(1.25,1.25){\vector(2,0){1}}
                \put(1.25,1.25){\vector(0,-1){1}}
                \put(2.25,1.3){\vector(0,1){0.3}}
                \put(2.0,1.05){$U(r)$}
                \put(1.8,1.7){$e_3^T\dot U(r)<0$}
                \put(1.3,0.2){$F_\rot$}
                \put(1.25,1.25){\line(-1,0){1}}
                \put(0.3,1.0){chord}
                \linethickness{0.1em}
                \put(1.25,1.25){\vector(-1,0){0.6}}
                \put(1.25,1.25){\vector(0,-1){0.6}}
                \put(0.75,1.35){$\mathbf{r}_x$}
                \put(1.3,0.6){$\mathbf{r}_z$}
            \end{picture}
        }
    }
    \caption{Direction of the rotational lift when $\alpha=0$}\label{fig:lift_rot}
\end{figure}

For the case of $\alpha=0$, the direction of the rotational lift is illustrated in Figure \ref{fig:lift_rot}, where the rotational lift is always opposite to $e_3^T \dot U$.
Therefore, its direction is given by $-\mathrm{sgn}(e_3^T \dot U) e_3$. 

These two cases for the direction can be combined into
\begin{equation}
    \mathrm{sig}_\rot (r) e_3, 
\end{equation}
where
\begin{equation}
    \mathrm{sig}_\rot = \mathrm{sgn}(\alpha(r))\{-\mathrm{sgn}(e_3^T U(r) )\mathrm{sgn}(\dot \alpha(r)) \} + (1-\mathrm{sgn}(\alpha(r)))\{-\mathrm{sgn}(e_3^T \dot U(r)) \},
\end{equation}
which takes the value of $\pm 1$. 
Thus, the rotational lift vector is the product of the above direction and the magnitude \eqref{eqn:F_rot_mag}. 
\begin{align}
d F_\rot & = \rho \|U(r)\| C_\rot |\dot\alpha(r)| \mathrm{sgn}_\rot (r) e_3  c^2(r) dr,
\end{align}
which is integrated to obtain the rotational force
\begin{align}
    F_\rot = \int_0^{l} dF_\rot.
\end{align}
\nomenclature{$F_\rot\in\Re^3$}{rotational force resolved in the wing fixed frame}

For the right wing, the above rotational force generate the moment about the wing root as follows.
\[
    M_{\rot_R} = \int_0^l re_2 \times d F_\rot,
\]
which is resolved in $\mathcal{F}_R$. 
For the left wing, the chord is located at $-r e_2$ in $\mathcal{F}_L$, and consequently
\[
    M_{\rot_L} = -\int_0^l re_2 \times d F_\rot.
\]
\nomenclature{$M_\rot\in\Re^3$}{moment about the wing root due to the rotational force, resolved in the wing fixed frame}

\subsubsection{Rotational Force for Small Body Velocities}

\paragraph{Right Wing}

Under the assumption of small body velocities, we present an expression for the rotational force that does not require a span-wise integration. 
As discussed above, when $\|\dot x\|,\|\Omega\|, \|v_{\mathrm{wind}}\| \ll 1$, $U_R(r)$ reduces to
\[
    U_R(r) = r \Omega_R \times e_2,
\]
so that $\alpha,\dot\alpha$ remains fixed span-wise. 
Thus,
\begin{align*}
    F_{\rot_R} & = \rho C_\rot  \|\Omega_R \times e_2 \| |\dot\alpha(t)|\; \mathrm{sgn}_\rot(t)  e_3 \int_0^l r c^2(r) dr,
\end{align*}
Substituting \eqref{eqn:int_rc2dr},
\begin{align*}
    F_{\rot_R} & = \rho C_\rot  \|\Omega_R \times e_2 \| |\dot\alpha(t)|\; \mathrm{sgn}_\rot(t)  e_3 l^2 \bar c^2 \tilde v \tilde r_1(v).
\end{align*}
Substituting \eqref{eqn:U_R}, we obtain the rotational force in terms of $U_R$ as 
\begin{align}
    F_{\rot_R} & = \rho C_\rot  \|U_R \| |\dot\alpha(t)|\; \mathrm{sgn}_\rot(t)  e_3 l \bar c^2 \frac{\tilde v \tilde r_1(v)}{\tilde r_2}. \label{eqn:F_rot}
\end{align}

Define $r_\rot\in\Re$ such that the moment about the wing root generated by the rotational force is written as
\begin{equation}
    M_{\rot_R} = r_\rot e_2 \times F_{\rot_R}.
\end{equation}
Using \eqref{eqn:int_rc2dr} and \eqref{eqn:int_r2c2dr}, one can show
\begin{align}
    r_\rot & = \frac{\int_0^l r^2 c^2(r) dr}{\int_0^l r c^2(r) dr} = \frac{l\tilde r_2^2(v)}{\tilde r_1(v)}.
\end{align}

\paragraph{Left Wing}

For the left wing,
\begin{align}
    F_{\rot_L} & = \rho C_\rot  \|U_L \| |\dot\alpha(t)|\; \mathrm{sgn}_\rot(t)  e_3 l \bar c^2 \frac{\tilde v \tilde r_1(v)}{\tilde r_2}, \label{eqn:F_rot_L}\\
    M_{\rot_L} &  = -r_\rot e_2 \times F_{\rot_L}.
\end{align}

\subsubsection{Numerical Example}

We evaluate the aerodynamic forces with the following lift/drag coefficient~\cite{sane2002aerodynamic}
\begin{align*}
    C_L & = 0.225 + 1.58 \sin( (2.13\alpha^\circ - 7.2) \frac{\pi}{180}),\\
    C_D & = 1.92 - 1.55 \cos( (2.04 \alpha^\circ - 9.82 ) \frac{\pi}{180}),\\
    C_\rot &  = \pi(0.75 - \hat x_0),
\end{align*}
where $\alpha^\circ = \alpha \frac{180}{\pi}$ is the angle of attack in degrees and $\hat x_0$ is chosen as $\hat x_0=0.5$. 
Wing morphological parameters are (arbitrarily) chosen as
\begin{gather*}
    l = 52.2\times 10^{-3} \mathrm{m}, \quad
    S = 1.23\times 10^{-3} \mathrm{m^2},\\ 
\tilde r_2 = 0.1,\quad \tilde r_3 = 0.1, \\
\tilde v =0.1, \quad \tilde r_1(v) =0.1, \quad \tilde r_2(v) =0.2.
\end{gather*}
For both of the left wing and the right wing, parameters for the wing kinematics are chosen as
\begin{gather*}
    f=50\,\mathrm{Hz},\quad \beta=0,\quad \phi_M=60^\circ, \quad \phi_K=0.9, \quad \phi_0 = 10^\circ,\\
    \theta_M = 50^\circ, \quad \theta_C = 4, \quad \theta_0 =0, \quad \psi_M=0.
\end{gather*}
Therefore, the motion of the left wing is symmetric to the right wing.
Three cases are considered for $\phi_a=0$ (symmetric rotation), $\phi_a=0.3$ (advanced rotation), and $\phi_a=-0.3$ (delayed rotation).

The resulting aerodynamic forces are illustrated in Figures \ref{fig:QS_sym}--\ref{fig:QS_dly}, where the subfigures (e) show the aerodynamic forces resolved in the wing-fixed frame. 
It is shown that the first component of the resultant force is almost zero. 
Thus, the resultant force is normal to the chord. 

Next, the last subfigures, namely (f) present the aerodynamic forces resolved in $\mathcal{F}_B$. 
Since $\beta=0$, the first component is the resultant lift normal to the stroke plane. 
It is shown that the advanced rotation generates an additional lift from the rotational force at the end of the upstroke and the downstroke. 


\begin{figure}[p]
    \centerline{
        \subfigure[$\phi,\theta,\psi$]{
            \includegraphics[width=0.45\textwidth]{QS_sym_E}
        }
        \hfill
        \subfigure[$\alpha$]{
            \includegraphics[width=0.45\textwidth]{QS_sym_alpha}
        }
    }
    \centerline{
        \subfigure[$U$]{
            \includegraphics[width=0.45\textwidth]{QS_sym_U}
        }
        \hfill
        \subfigure[$\dot\alpha \|U\|$]{
            \includegraphics[width=0.45\textwidth]{QS_sym_U_alpha_dot}
        }
    }
    \centerline{
        \subfigure[Aerodynamic forces in the wing-fixed frame]{
            \includegraphics[width=0.45\textwidth]{QS_sym_F_W}
        }
        \hfill
        \subfigure[Aerodynamic forces in the body-fixed frame]{
            \includegraphics[width=0.45\textwidth]{QS_sym_F_B}
        }
    }
    \caption{Symmetric rotation}\label{fig:QS_sym}
\end{figure}

\begin{figure}[p]
    \centerline{
        \subfigure[$\phi,\theta,\psi$]{
            \includegraphics[width=0.45\textwidth]{QS_adv_E}
        }
        \hfill
        \subfigure[$\alpha$]{
            \includegraphics[width=0.45\textwidth]{QS_adv_alpha}
        }
    }
    \centerline{
        \subfigure[$U$]{
            \includegraphics[width=0.45\textwidth]{QS_adv_U}
        }
        \hfill
        \subfigure[$\dot\alpha \|U\|$]{
            \includegraphics[width=0.45\textwidth]{QS_adv_U_alpha_dot}
        }
    }
    \centerline{
        \subfigure[Aerodynamic forces in the wing-fixed frame]{
            \includegraphics[width=0.45\textwidth]{QS_adv_F_W}
        }
        \hfill
        \subfigure[Aerodynamic forces in the body-fixed frame]{
            \includegraphics[width=0.45\textwidth]{QS_adv_F_B}
        }
    }
    \caption{Advanced rotation}\label{fig:QS_adv}
\end{figure}

\begin{figure}[p]
    \centerline{
        \subfigure[$\phi,\theta,\psi$]{
            \includegraphics[width=0.45\textwidth]{QS_dly_E}
        }
        \hfill
        \subfigure[$\alpha$]{
            \includegraphics[width=0.45\textwidth]{QS_dly_alpha}
        }
    }
    \centerline{
        \subfigure[$U$]{
            \includegraphics[width=0.45\textwidth]{QS_dly_U}
        }
        \hfill
        \subfigure[$\dot\alpha \|U\|$]{
            \includegraphics[width=0.45\textwidth]{QS_dly_U_alpha_dot}
        }
    }
    \centerline{
        \subfigure[Aerodynamic forces in the wing-fixed frame]{
            \includegraphics[width=0.45\textwidth]{QS_dly_F_W}
        }
        \hfill
        \subfigure[Aerodynamic forces in the body-fixed frame]{
            \includegraphics[width=0.45\textwidth]{QS_dly_F_B}
        }
    }
    \caption{Delayed rotation}\label{fig:QS_dly}
\end{figure}

\newpage

\subsection{Flapping Wing UAV Dynamics}

\subsubsection{Equations of Motion}

We present the equations of motion assuming that the mass and the inertia of both wings are negligible. 
Let $J\in\Re^{3\times 3}$ be the inertia matrix of the body in $\mathcal{F}_B$, and let $m\in\Re$ be the mass of the body. 
\nomenclature{$m\in\Re$}{mass of the body}
\nomenclature{$J\in\Re^{3\times 3}$}{inertia matrix of the body about its mass center resolved in $\mathcal{F}_B$}

From Netwon's second law, 
\begin{align}
    m \ddot x & =  RQ_R (L_R+D_R+F_{\rot _R}) + R Q_L (L_L+D_L + F_{\rot_L}) + mg e_3,\\
    J\dot\Omega + \Omega\times J\Omega & =  (\mu_R + r_{cp} Q_R e_2) \times Q_R (L_R+D_R) + (\mu_R + r_{\rot} Q_R e_2)\times Q_R F_{\rot_R}\nonumber\\
                                       & \quad + (\mu_L - r_{cp} Q_L e_2) \times Q_L (L_L+D_L) + (\mu_L + r_{\rot} Q_L e_2)\times Q_L F_{\rot_L},
\end{align}
with the kinematics equations copied below
\begin{align}
    \dot R & = R\hat\Omega,\\
    \dot Q_R & = Q_R \hat\Omega_R,\\
    \dot Q_L & = Q_L \hat\Omega_L.
\end{align}
These are driven by the wing kinematics that describe the attitude of the wings relative to the body, namely $Q_R(t), Q_L(t)$.

\bibliographystyle{IEEEtran}
\bibliography{FWUAV}

\appendix

\subsection*{Appendix}

\subsubsection*{Hat Map}

For $x=(x_1,x_2,x_3)\in\Re^3$, 
\begin{align}
    \hat x = \begin{bmatrix}
        0 & -x_3 & x_2 \\
        x_3 & 0 & -x_1 \\
        -x_2 & x_1 & 0 
    \end{bmatrix},
\end{align}


\subsubsection*{Sign Function}

For $x\in\Re$, 
\begin{align}
    \mathrm{sgn}(x) =
    \begin{cases}
        1 &  x>0,\\
        0 &  x=0,\\
        -1 & x<0.
    \end{cases}
\end{align}

\end{document}

